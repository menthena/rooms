{"version":3,"sources":["app/components/floors/room.ts"],"names":["Room","Room.constructor","Room.openReservationModal","Room.handleEditReservation","Room.destroy","Room.editElement","Room.getActiveReservation","Room.checkAvailability","Room.handleClick","Room.ngOnDestroy","Room.ngOnInit"],"mappings":"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ACA;oBAC3EA,MAAMA,CAACA,GAAGA,CAACA,KAAIA,CAACA,MAAMA,CAACA,kBAAkBA,CAACA,CAACA,IAAIA,CAACA,GAAGA,CAACA,eAAeA,CAACA,IAAIA,CAACA,CAACA;YAC9EA,CAACA,CAACA;iBACDA,MAAMA,CAACA,UAACA,GAAQA;gBACfA,MAAMA,CAACA,MAAMA,CAACA,GAAGA,CAACA,KAAIA,CAACA,MAAMA,CAACA,eAAeA,CAACA,CAACA,IAAIA,CAACA,GAAGA,CAACA,kBAAkBA,CAACA,GAAGA,CAACA,CAACA;YAClFA,CAACA,CAACA;iBACDA,SAASA,CAACA,UAACA,GAAQA;gBAClBA,KAAIA,CAACA,oBAAoBA,CAACA,GAAGA,CAACA,CAACA;gBAC/BA,KAAIA,CAACA,QAAQA,GAAGA,KAAKA,CAACA;YACxBA,CAACA,CAACA,CAACA;YAELA,EAAEA,CAACA,CAACA,IAAIA,CAACA,MAAMA,CAACA,QAAQA,GAAGA,IAAIA,CAACA,IAAIA,CAACA,QAAQA,CAACA,CAACA,CAACA;gBAC9CA,IAAIA,CAACA,OAAOA,GAAGA,KAAKA,CAACA;YACvBA,CAACA;YACDA,EAAEA,CAACA,CAACA,IAAIA,CAACA,MAAMA,CAACA,QAAQA,CAACA,CAACA,CAACA;gBACzBA,IAAIA,CAACA,MAAMA,CAACA,QAAQA,CAACA,GAAGA,CAACA,UAACA,GAAGA;oBAC3BA,EAAEA,CAACA,CAACA,KAAIA,CAACA,IAAIA,CAACA,QAAQA,CAACA,OAAOA,CAACA,GAAGA,CAACA,KAAKA,CAACA,CAACA,CAACA,CAACA,CAACA;wBAC3CA,OAAOA,CAACA,GAAGA,CAACA,GAAGA,CAACA,CAACA;wBACjBA,KAAIA,CAACA,OAAOA,GAAGA,KAAKA,CAACA;oBACvBA,CAACA;gBACHA,CAACA,CAACA,CAACA;YACLA,CAACA;YACDA,IAAIA,CAACA,SAASA,CAACA,aAAaA,EAAEA,CAACA;QACjCA,CAACA;IACHA,CAACA;IAEDP,0BAAWA,GAAXA;QACEQ,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,UAAUA,IAAIA,IAAIA,CAACA,QAAQA,IAAIA,IAAIA,CAACA,OAAOA,CAACA,CAACA,CAACA;YACtDA,IAAIA,CAACA,oBAAoBA,EAAEA,CAACA;QAC9BA,CAACA;IACHA,CAACA;IAEDR,0BAAWA,GAAXA;QACES,IAAIA,CAACA,kBAAkBA,CAACA,WAAWA,EAAEA,CAACA;QACtCA,IAAIA,CAACA,qBAAqBA,CAACA,WAAWA,EAAEA,CAACA;IAC3CA,CAACA;IAEDT,uBAAQA,GAARA;QAAAU,iBAyBCA;QAxBCA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,yBAAyBA,CAACA,YAAYA,CAACA,CAACA,CAACA;YACjDA,IAAIA,CAACA,yBAAyBA,CAACA,OAAOA,EAAEA,CAACA;QAC3CA,CAACA;QACDA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,mBAAmBA,CAACA,YAAYA,CAACA,CAACA,CAACA;YAC3CA,IAAIA,CAACA,mBAAmBA,CAACA,OAAOA,EAAEA,CAACA;QACrCA,CAACA;QACDA,IAAIA,CAACA,kBAAkBA,GAAGA,IAAIA,CAACA,yBAAyBA;aACrDA,SAASA,CAACA,UAAAA,GAAGA;YACZA,KAAIA,CAACA,MAAMA,GAAGA,KAAIA,CAACA,kBAAkBA,CAACA,MAAMA,CAACA;YAC7CA,KAAIA,CAACA,iBAAiBA,EAAEA,CAACA;QAC3BA,CAACA,CAACA,CAACA;QACLA,IAAIA,CAACA,YAAYA,GAAGA,IAAIA,CAACA,kBAAkBA,CAACA,YAAYA,CAACA;QACzDA,IAAIA,CAACA,MAAMA,GAAGA,IAAIA,CAACA,kBAAkBA,CAACA,MAAMA,CAACA;QAC7CA,IAAIA,CAACA,iBAAiBA,EAAEA,CAACA;QACzBA,IAAIA,CAACA,qBAAqBA,GAAGA,IAAIA,CAACA,mBAAmBA;aAClDA,SAASA,CAACA,UAAAA,GAAGA;YACZA,EAAEA,CAACA,CAACA,GAAGA,KAAKA,SAASA,CAACA,CAACA,CAACA;gBACtBA,KAAIA,CAACA,sBAAsBA,GAAGA,KAAKA,CAACA;YACtCA,CAACA;YACDA,EAAEA,CAACA,CAACA,GAAGA,IAAIA,GAAGA,CAACA,IAAIA,CAACA,CAACA,CAACA;gBACpBA,KAAIA,CAACA,YAAYA,GAAGA,GAAGA,CAACA,IAAIA,CAACA;gBAC7BA,KAAIA,CAACA,iBAAiBA,EAAEA,CAACA;YAC3BA,CAACA;QACHA,CAACA,CAACA,CAACA;IACPA,CAACA;IAlIDV;QAACA,YAAKA,EAAEA;;OAACA,sBAAIA,UAAgBA;IArD/BA;QAACA,gBAASA,CAACA;YACTA,QAAQA,EAAEA,MAAMA;YAChBA,UAAUA,EAAEA,CAAEA,qBAASA,EAAEA,qBAASA,EAAEA,0BAAWA,EAAEA,4BAAYA;gBAC3DA,oCAAgBA,EAAEA,0BAAWA,EAAEA,iBAAOA,CAACA;YACzCA,MAAMA,EAAEA,CAACA,MAAMA,EAAEA,YAAYA,CAACA;YAC9BA,SAASA,EAAEA,CAACA,wBAAwBA,EAAEA,4BAA4BA,CAACA;YACnEA,QAAQA,EAAEA,guEA2CTA;SACFA,CAACA;;aAsIDA;IAADA,WAACA;;AAADA,CAxLA,AAwLCA,IAAA;AApIY,YAAI,OAoIhB,CAAA","file":"app/components/floors/room.js","sourcesContent":["import {Component, Attribute,  Input, OnInit, ElementRef, ChangeDetectorRef} from 'angular2/core';\nimport {Observable} from 'rxjs';\nimport {DATE_FORMAT} from '../../config/constants';\nimport {IFloorElement} from '../../services/FloorElementsService';\nimport {IReservation, ReservationService} from '../../services/ReservationService';\nimport {EditElement} from '../design/edit-element';\nimport {Resizable} from '../../directives/resizable';\nimport {Draggable} from '../../directives/draggable';\nimport {Popover} from '../../directives/popover';\nimport {PlaceElement} from '../../directives/place-element';\nimport {ReservationModal} from '../reservation/reservation-modal';\nimport {FloorElementsService} from '../../services/FloorElementsService';\nimport {DesignService} from '../../services/DesignService';\n\ndeclare var jQuery:any;\ndeclare var moment:any;\ndeclare var _:any;\n\n@Component({\n  selector: 'room',\n  directives: [ Resizable, Draggable, EditElement, PlaceElement,\n    ReservationModal, EditElement, Popover],\n  inputs: ['data', 'designMode'],\n  styleUrls: ['styles/floors/room.css', 'styles/common/controls.css'],\n  template: `\n    <div class=\"wrapper control\" resizable-element draggable-element\n    [containment]=\"'#floor' + data.floorID\" [attr.element-id]=\"data.elementID\" [attr.data-id]=\"data.floorID\"\n      [class.reserved]=\"!designMode && !isActive\" [class.not-match]=\"!designMode && !isMatch\"\n      [class.reservation-modal-opened]=\"reservationModalOpened\">\n      <reservation-modal\n        *ngIf=\"!designMode\"\n        [activeReservation]=\"activeReservation\"\n        [data]=\"data\"\n        place-element [place-type]=\"'modal'\"></reservation-modal>\n      <edit-element *ngIf=\"designMode\" place-element place-type=\"modal\" [data]=\"data\"></edit-element>\n      <popover [data]=\"data\" [reservations]=\"reservations\"\n        (edit-reservation)=\"handleEditReservation()\"\n        [activeReservation]=\"activeReservation\"></popover>\n      <div class=\"room\" (click)=\"handleClick()\">\n        <div><span>{{ data.elementName }}</span></div>\n        <div class=\"second-line\">\n          <div *ngIf=\"designMode\">\n            <a (click)=\"editElement()\"><i class=\"fa fa-pencil\"></i></a>\n            <a (click)=\"destroy()\"><i class=\"fa fa-trash\"></i></a>\n          </div>\n          <div *ngIf=\"!designMode && isActive && isMatch\">\n            <div class=\"features pull-left\">\n              <span><i class=\"fa fa-user\"></i> {{ data.capacity }}</span>\n              <span><i class=\"fa fa-television\" *ngIf=\"data.features && data.features.indexOf('tv') > -1\"></i></span>\n              <span><i class=\"fa fa-phone\" *ngIf=\"data.features && data.features.indexOf('phone') > -1\"></i></span>\n            </div>\n            <div class=\"book pull-right hidden-xs\">\n              <i class=\"fa fa-plus-square\"></i>\n            </div>\n            <i class=\"visible-xs fa fa-plus-square\"></i>\n          </div>\n          <div *ngIf=\"!designMode && !isActive\" class=\"reserved\">\n            <i class=\"visible-xs fa fa-ban\"></i>\n            <span>Reserved</span>\n          </div>\n          <div *ngIf=\"!designMode && isActive && !isMatch\" class=\"reserved\">\n            <i class=\"visible-xs fa fa-filter\"></i>\n            <span>Not a match</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  `\n})\n\nexport class Room implements OnInit {\n  @Input() data: IFloorElement;\n  reservations: Array<IReservation>;\n  activeReservation: IReservation;\n  floorElementsObservable;\n  designMode: boolean;\n  reservationObserver;\n  designObservable;\n  reservationSubscriber;\n  filterSubscription;\n  isActive: boolean;\n  isMatch: boolean;\n  reservationModalOpened: boolean;\n  filter: any;\n  reservationFilterObserver;\n\n  constructor(private elementRef: ElementRef, private ReservationService: ReservationService,\n      DesignService: DesignService, private FloorElementsService: FloorElementsService,\n      private changeRef: ChangeDetectorRef) {\n    this.reservationFilterObserver = ReservationService.getReservationFilterObserver();\n    this.reservationObserver = ReservationService.getObservable();\n    this.isActive = true;\n    this.isMatch = true;\n    this.designObservable = DesignService.getObservable();\n    this.designMode = DesignService.designModeState;\n  }\n\n  openReservationModal() {\n    this.reservationModalOpened = true;\n    this.checkAvailability();\n    this.reservationObserver\n      .subscription\n      .next(this.data.elementID);\n  }\n\n  handleEditReservation() {\n    this.openReservationModal();\n  }\n\n  destroy() {\n    this.FloorElementsService\n      .deleteElement(this.data.floorID, this.data.elementID);\n  }\n\n  editElement() {\n    this.designObservable\n      .subscription\n      .next({\n        type: 'edit',\n        data: this.data.elementID\n      });\n  }\n\n  getActiveReservation(res) {\n    if (res) {\n      this.activeReservation = _.find(this.reservations, { reservationID: res.reservationID });\n    }\n  }\n\n  checkAvailability() {\n    this.isMatch = true;\n    this.isActive = true;\n    this.activeReservation = undefined;\n    if (!this.designMode && this.filter) {\n      Observable.fromArray(this.reservations)\n        .filter(res => {\n          return res.elementID === this.data.elementID;\n        })\n        .filter((res: any) => {\n          return moment.utc(this.filter.reservationDate).diff(res.reservationDate) >= 0 ||\n            moment.utc(this.filter.reservationEndDate).diff(res.reservationDate) >= 0;\n        })\n        .filter((res: any) => {\n          return moment.utc(this.filter.reservationDate).diff(res.reservationEndDate) < 0;\n        })\n        .subscribe((res: any) => {\n          this.getActiveReservation(res);\n          this.isActive = false;\n        });\n\n      if (this.filter.capacity < this.data.capacity) {\n        this.isMatch = false;\n      }\n      if (this.filter.features) {\n        this.filter.features.map((res) => {\n          if (this.data.features.indexOf(res) === -1) {\n            console.log(res);\n            this.isMatch = false;\n          }\n        });\n      }\n      this.changeRef.detectChanges();\n    }\n  }\n\n  handleClick() {\n    if (!this.designMode && this.isActive && this.isMatch) {\n      this.openReservationModal();\n    }\n  }\n\n  ngOnDestroy() {\n    this.filterSubscription.unsubscribe();\n    this.reservationSubscriber.unsubscribe();\n  }\n\n  ngOnInit() {\n    if (!this.reservationFilterObserver.subscription) {\n      this.reservationFilterObserver.connect();\n    }\n    if (!this.reservationObserver.subscription) {\n      this.reservationObserver.connect();\n    }\n    this.filterSubscription = this.reservationFilterObserver\n      .subscribe(res => {\n        this.filter = this.ReservationService.filter;\n        this.checkAvailability();\n      });\n    this.reservations = this.ReservationService.reservations;\n    this.filter = this.ReservationService.filter;\n    this.checkAvailability();\n    this.reservationSubscriber = this.reservationObserver\n      .subscribe(res => {\n        if (res === undefined) {\n          this.reservationModalOpened = false;\n        }\n        if (res && res.type) {\n          this.reservations = res.data;\n          this.checkAvailability();\n        }\n      });\n  }\n}\n"],"sourceRoot":"/source/"}