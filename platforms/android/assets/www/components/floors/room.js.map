{"version":3,"sources":["app/components/floors/room.ts"],"names":["Room","Room.constructor","Room.openReservationModal","Room.handleEditReservation","Room.destroy","Room.editElement","Room.getActiveReservation","Room.checkAvailability","Room.handleClick","Room.ngOnDestroy","Room.ngOnInit"],"mappings":"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,IAAIA,CAACA,GAAGA,CAACA,kBAAkBA,CAACA,GAAGA,CAACA,CAACA;wBAClFA,CAACA,CAACA;6BACDA,SAASA,CAACA,UAACA,GAAQA;4BAClBA,KAAIA,CAACA,oBAAoBA,CAACA,GAAGA,CAACA,CAACA;4BAC/BA,KAAIA,CAACA,QAAQA,GAAGA,KAAKA,CAACA;wBACxBA,CAACA,CAACA,CAACA;wBAELA,EAAEA,CAACA,CAACA,IAAIA,CAACA,MAAMA,CAACA,QAAQA,GAAGA,IAAIA,CAACA,IAAIA,CAACA,QAAQA,CAACA,CAACA,CAACA;4BAC9CA,IAAIA,CAACA,OAAOA,GAAGA,KAAKA,CAACA;wBACvBA,CAACA;wBACDA,EAAEA,CAACA,CAACA,IAAIA,CAACA,MAAMA,CAACA,QAAQA,CAACA,CAACA,CAACA;4BACzBA,IAAIA,CAACA,MAAMA,CAACA,QAAQA,CAACA,GAAGA,CAACA,UAACA,GAAGA;gCAC3BA,EAAEA,CAACA,CAACA,KAAIA,CAACA,IAAIA,CAACA,QAAQA,CAACA,OAAOA,CAACA,GAAGA,CAACA,KAAKA,CAACA,CAACA,CAACA,CAACA,CAACA;oCAC3CA,OAAOA,CAACA,GAAGA,CAACA,GAAGA,CAACA,CAACA;oCACjBA,KAAIA,CAACA,OAAOA,GAAGA,KAAKA,CAACA;gCACvBA,CAACA;4BACHA,CAACA,CAACA,CAACA;wBACLA,CAACA;wBACDA,IAAIA,CAACA,SAASA,CAACA,aAAaA,EAAEA,CAACA;oBACjCA,CAACA;gBACHA,CAACA;gBAEDP,0BAAWA,GAAXA;oBACEQ,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,UAAUA,IAAIA,IAAIA,CAACA,QAAQA,IAAIA,IAAIA,CAACA,OAAOA,CAACA,CAACA,CAACA;wBACtDA,IAAIA,CAACA,oBAAoBA,EAAEA,CAACA;oBAC9BA,CAACA;gBACHA,CAACA;gBAEDR,0BAAWA,GAAXA;oBACES,IAAIA,CAACA,kBAAkBA,CAACA,WAAWA,EAAEA,CAACA;oBACtCA,IAAIA,CAACA,qBAAqBA,CAACA,WAAWA,EAAEA,CAACA;gBAC3CA,CAACA;gBAEDT,uBAAQA,GAARA;oBAAAU,iBAyBCA;oBAxBCA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,yBAAyBA,CAACA,YAAYA,CAACA,CAACA,CAACA;wBACjDA,IAAIA,CAACA,yBAAyBA,CAACA,OAAOA,EAAEA,CAACA;oBAC3CA,CAACA;oBACDA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,mBAAmBA,CAACA,YAAYA,CAACA,CAACA,CAACA;wBAC3CA,IAAIA,CAACA,mBAAmBA,CAACA,OAAOA,EAAEA,CAACA;oBACrCA,CAACA;oBACDA,IAAIA,CAACA,kBAAkBA,GAAGA,IAAIA,CAACA,yBAAyBA;yBACrDA,SAASA,CAACA,UAAAA,GAAGA;wBACZA,KAAIA,CAACA,MAAMA,GAAGA,KAAIA,CAACA,kBAAkBA,CAACA,MAAMA,CAACA;wBAC7CA,KAAIA,CAACA,iBAAiBA,EAAEA,CAACA;oBAC3BA,CAACA,CAACA,CAACA;oBACLA,IAAIA,CAACA,YAAYA,GAAGA,IAAIA,CAACA,kBAAkBA,CAACA,YAAYA,CAACA;oBACzDA,IAAIA,CAACA,MAAMA,GAAGA,IAAIA,CAACA,kBAAkBA,CAACA,MAAMA,CAACA;oBAC7CA,IAAIA,CAACA,iBAAiBA,EAAEA,CAACA;oBACzBA,IAAIA,CAACA,qBAAqBA,GAAGA,IAAIA,CAACA,mBAAmBA;yBAClDA,SAASA,CAACA,UAAAA,GAAGA;wBACZA,EAAEA,CAACA,CAACA,GAAGA,KAAKA,SAASA,CAACA,CAACA,CAACA;4BACtBA,KAAIA,CAACA,sBAAsBA,GAAGA,KAAKA,CAACA;wBACtCA,CAACA;wBACDA,EAAEA,CAACA,CAACA,GAAGA,IAAIA,GAAGA,CAACA,IAAIA,CAACA,CAACA,CAACA;4BACpBA,KAAIA,CAACA,YAAYA,GAAGA,GAAGA,CAACA,IAAIA,CAACA;4BAC7BA,KAAIA,CAACA,iBAAiBA,EAAEA,CAACA;wBAC3BA,CAACA;oBACHA,CAACA,CAACA,CAACA;gBACPA,CAACA;gBAlIDV;oBAACA,YAAKA,EAAEA;;mBAACA,sBAAIA,UAAgBA;gBArD/BA;oBAACA,gBAASA,CAACA;wBACTA,QAAQA,EAAEA,MAAMA;wBAChBA,UAAUA,EAAEA,CAAEA,qBAASA,EAAEA,qBAASA,EAAEA,0BAAWA,EAAEA,4BAAYA;4BAC3DA,oCAAgBA,EAAEA,0BAAWA,EAAEA,iBAAOA,CAACA;wBACzCA,MAAMA,EAAEA,CAACA,MAAMA,EAAEA,YAAYA,CAACA;wBAC9BA,SAASA,EAAEA,CAACA,wBAAwBA,EAAEA,4BAA4BA,CAACA;wBACnEA,QAAQA,EAAEA,guEA2CTA;qBACFA,CAACA;;yBAsIDA;gBAADA,WAACA;YAADA,CAxLA,AAwLCA,IAAA;YAxLD,uBAwLC,CAAA","file":"app/components/floors/room.js","sourcesContent":["import {Component, Attribute,  Input, OnInit, ElementRef, ChangeDetectorRef} from 'angular2/core';\nimport {Observable} from 'rxjs/Observable';\nimport {DATE_FORMAT} from '../../constants';\nimport {IFloorElement} from '../../services/FloorElementsService';\nimport {IReservation, ReservationService} from '../../services/ReservationService';\nimport {EditElement} from '../design/edit-element';\nimport {Resizable} from '../../directives/resizable';\nimport {Draggable} from '../../directives/draggable';\nimport {Popover} from '../../directives/popover';\nimport {PlaceElement} from '../../directives/place-element';\nimport {ReservationModal} from '../reservation/reservation-modal';\nimport {FloorElementsService} from '../../services/FloorElementsService';\nimport {DesignService} from '../../services/DesignService';\n\ndeclare var jQuery:any;\ndeclare var moment:any;\n\n@Component({\n  selector: 'room',\n  directives: [ Resizable, Draggable, EditElement, PlaceElement,\n    ReservationModal, EditElement, Popover],\n  inputs: ['data', 'designMode'],\n  styleUrls: ['styles/floors/room.css', 'styles/common/controls.css'],\n  template: `\n    <div class=\"wrapper control\" resizable-element draggable-element\n    [containment]=\"'#floor' + data.floorID\" [attr.element-id]=\"data.elementID\" [attr.data-id]=\"data.floorID\"\n      [class.reserved]=\"!designMode && !isActive\" [class.not-match]=\"!designMode && !isMatch\"\n      [class.reservation-modal-opened]=\"reservationModalOpened\">\n      <reservation-modal\n        *ngIf=\"!designMode\"\n        [activeReservation]=\"activeReservation\"\n        [data]=\"data\"\n        place-element [place-type]=\"'modal'\"></reservation-modal>\n      <edit-element *ngIf=\"designMode\" place-element place-type=\"modal\" [data]=\"data\"></edit-element>\n      <popover [data]=\"data\" [reservations]=\"reservations\"\n        (edit-reservation)=\"handleEditReservation()\"\n        [activeReservation]=\"activeReservation\"></popover>\n      <div class=\"room\" (click)=\"handleClick()\">\n        <div><span>{{ data.elementName }}</span></div>\n        <div class=\"second-line\">\n          <div *ngIf=\"designMode\">\n            <a (click)=\"editElement()\"><i class=\"fa fa-pencil\"></i></a>\n            <a (click)=\"destroy()\"><i class=\"fa fa-trash\"></i></a>\n          </div>\n          <div *ngIf=\"!designMode && isActive && isMatch\">\n            <div class=\"features pull-left\">\n              <span><i class=\"fa fa-user\"></i> {{ data.capacity }}</span>\n              <span><i class=\"fa fa-television\" *ngIf=\"data.features && data.features.indexOf('tv') > -1\"></i></span>\n              <span><i class=\"fa fa-phone\" *ngIf=\"data.features && data.features.indexOf('phone') > -1\"></i></span>\n            </div>\n            <div class=\"book pull-right hidden-xs\">\n              <i class=\"fa fa-plus-square\"></i>\n            </div>\n            <i class=\"visible-xs fa fa-plus-square\"></i>\n          </div>\n          <div *ngIf=\"!designMode && !isActive\" class=\"reserved\">\n            <i class=\"visible-xs fa fa-ban\"></i>\n            <span>Reserved</span>\n          </div>\n          <div *ngIf=\"!designMode && isActive && !isMatch\" class=\"reserved\">\n            <i class=\"visible-xs fa fa-filter\"></i>\n            <span>Not a match</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  `\n})\n\nexport class Room implements OnInit {\n  @Input() data: IFloorElement;\n  reservations: Array<IReservation>;\n  activeReservation: IReservation;\n  floorElementsObservable;\n  designMode: boolean;\n  reservationObserver;\n  designObservable;\n  reservationSubscriber;\n  filterSubscription;\n  isActive: boolean;\n  isMatch: boolean;\n  reservationModalOpened: boolean;\n  filter: any;\n  reservationFilterObserver;\n\n  constructor(private elementRef: ElementRef, private ReservationService: ReservationService,\n      DesignService: DesignService, private FloorElementsService: FloorElementsService,\n      private changeRef: ChangeDetectorRef) {\n    this.reservationFilterObserver = ReservationService.getReservationFilterObserver();\n    this.reservationObserver = ReservationService.getObservable();\n    this.isActive = true;\n    this.isMatch = true;\n    this.designObservable = DesignService.getObservable();\n    this.designMode = DesignService.designModeState;\n  }\n\n  openReservationModal() {\n    this.reservationModalOpened = true;\n    this.checkAvailability();\n    this.reservationObserver\n      .subscription\n      .next(this.data.elementID);\n  }\n\n  handleEditReservation() {\n    this.openReservationModal();\n  }\n\n  destroy() {\n    this.FloorElementsService\n      .deleteElement(this.data.floorID, this.data.elementID);\n  }\n\n  editElement() {\n    this.designObservable\n      .subscription\n      .next({\n        type: 'edit',\n        data: this.data.elementID\n      });\n  }\n\n  getActiveReservation(res) {\n    if (res) {\n      this.activeReservation = _.find(this.reservations, { reservationID: res.reservationID });\n    }\n  }\n\n  checkAvailability() {\n    this.isMatch = true;\n    this.isActive = true;\n    this.activeReservation = undefined;\n    if (!this.designMode && this.filter) {\n      Observable.fromArray(this.reservations)\n        .filter(res => {\n          return res.elementID === this.data.elementID;\n        })\n        .filter((res: any) => {\n          return moment.utc(this.filter.reservationDate).diff(res.reservationDate) >= 0 ||\n            moment.utc(this.filter.reservationEndDate).diff(res.reservationDate) >= 0;\n        })\n        .filter((res: any) => {\n          return moment.utc(this.filter.reservationDate).diff(res.reservationEndDate) < 0;\n        })\n        .subscribe((res: any) => {\n          this.getActiveReservation(res);\n          this.isActive = false;\n        });\n\n      if (this.filter.capacity < this.data.capacity) {\n        this.isMatch = false;\n      }\n      if (this.filter.features) {\n        this.filter.features.map((res) => {\n          if (this.data.features.indexOf(res) === -1) {\n            console.log(res);\n            this.isMatch = false;\n          }\n        });\n      }\n      this.changeRef.detectChanges();\n    }\n  }\n\n  handleClick() {\n    if (!this.designMode && this.isActive && this.isMatch) {\n      this.openReservationModal();\n    }\n  }\n\n  ngOnDestroy() {\n    this.filterSubscription.unsubscribe();\n    this.reservationSubscriber.unsubscribe();\n  }\n\n  ngOnInit() {\n    if (!this.reservationFilterObserver.subscription) {\n      this.reservationFilterObserver.connect();\n    }\n    if (!this.reservationObserver.subscription) {\n      this.reservationObserver.connect();\n    }\n    this.filterSubscription = this.reservationFilterObserver\n      .subscribe(res => {\n        this.filter = this.ReservationService.filter;\n        this.checkAvailability();\n      });\n    this.reservations = this.ReservationService.reservations;\n    this.filter = this.ReservationService.filter;\n    this.checkAvailability();\n    this.reservationSubscriber = this.reservationObserver\n      .subscribe(res => {\n        if (res === undefined) {\n          this.reservationModalOpened = false;\n        }\n        if (res && res.type) {\n          this.reservations = res.data;\n          this.checkAvailability();\n        }\n      });\n  }\n}\n"],"sourceRoot":"/source/"}