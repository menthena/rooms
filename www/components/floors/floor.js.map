{"version":3,"sources":["app/components/floors/floor.ts"],"names":["Floor","Floor.constructor","Floor.switchEditMode","Floor.cancelEditFloorNameForm","Floor.submitEditFloorNameForm","Floor.fetch","Floor.ngOnInit"],"mappings":"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","file":"app/components/floors/floor.js","sourcesContent":["import {Component, Input, NgZone, ChangeDetectionStrategy, ChangeDetectorRef, EventEmitter} from 'angular2/core';\nimport {FormBuilder, Validators} from 'angular2/common';\nimport {Observable} from 'rxjs';\nimport {IFloor} from '../../services/FloorService';\nimport {FloorElementsService, IFloorElement} from '../../services/FloorElementsService';\nimport {Room} from './room';\nimport {SOCKET_URL} from '../../config/constants';\nimport {ReservationModal} from '../reservation/reservation-modal';\nimport {AppService} from '../../services/AppService';\nimport {FloorService} from '../../services/FloorService';\nimport {Placeholder} from './placeholder';\nimport {Line} from './line';\nimport {Icon} from './icon';\nimport {LoadingIndicator} from '../../directives/loading-indicator';\nimport {PlaceElement} from '../../directives/place-element';\nimport {EditElement} from '../design/edit-element';\nimport {Droppable} from '../../directives/droppable';\nimport {DesignService} from '../../services/DesignService';\nimport {IReservation, ReservationService} from '../../services/ReservationService';\n\ndeclare var _: any;\ndeclare var io: any;\n\n@Component({\n  selector: 'floor',\n  providers: [FloorElementsService],\n  directives: [Room, Icon, PlaceElement, Placeholder, Line, Droppable, LoadingIndicator],\n  styleUrls: ['styles/floors/floor.css', 'styles/floors/floors.css'],\n  template: `\n  <div [ngClass]=\"{'design-mode': designMode}\">\n    <ul class=\"list-inline\">\n      <li *ngIf=\"!isIonic\">\n        <h1 *ngIf=\"!editMode\">\n          {{ floor.floorName }}\n          <span *ngIf=\"designMode\">\n            <a (click)=\"switchEditMode()\" class=\"btn\"><i class=\"fa fa-pencil\"></i></a>\n          </span>\n        </h1>\n        <div *ngIf=\"editMode\" class=\"header\">\n          <form [ngFormModel]=\"editFloorNameForm\">\n            <input type=\"text\" name=\"floorName\" id=\"floorName\" ngControl=\"floorName\">\n            <button (click)=\"submitEditFloorNameForm($event)\" type=\"submit\" class=\"btn\"><i class=\"fa fa-check\"></i></button>\n            <button (click)=\"cancelEditFloorNameForm($event)\" class=\"btn\"><i class=\"fa fa-times\"></i></button>\n          </form>\n        </div>\n      </li>\n      <li *ngIf=\"!isIonic\">\n        <loading-indicator *ngIf=\"isLoading\" mini=\"true\"></loading-indicator>\n      </li>\n    </ul>\n    <div [attr.id]=\"'floor' + floor.floorID\" class=\"floor\" droppable-element\n      [attr.data-id]=\"floor.floorID\" [ngClass]=\"{loading: isLoading}\">\n      <div class=\"inner\">\n        <div *ngFor=\"#element of floorElements\" [ngSwitch]=\"element.elementType\">\n          <room *ngSwitchWhen=\"'room'\" [data]=\"element\" place-element></room>\n          <line *ngSwitchWhen=\"'line'\" [data]=\"element\" place-element></line>\n          <placeholder *ngSwitchWhen=\"'placeholder'\" [data]=\"element\" place-element></placeholder>\n          <icon *ngSwitchDefault [data]=\"element\" place-element></icon>\n        </div>\n      </div>\n    </div>\n  </div>\n  `\n})\n\nexport class Floor {\n  @Input() floor: IFloor;\n  @Input() isLoading: boolean;\n  // @Output() deleteFloor = new EventEmitter();\n  // @Output() updateFloor = new EventEmitter();\n  floorElements: Array<IFloorElement>;\n  reservations: Array<IReservation>;\n  floorElementsObservable;\n  editMode: boolean;\n  isIonic: boolean;\n  designMode: boolean;\n  editFloorNameForm;\n\n  constructor(private floorElementsService: FloorElementsService,\n    private changeRef: ChangeDetectorRef, private DesignService: DesignService,\n    private ReservationService: ReservationService, private fb: FormBuilder,\n    private floorService: FloorService, private AppService: AppService\n  ) {\n    this.floorElements = [];\n    this.floorElementsObservable = this.floorElementsService.getObservable();\n    this.floorElementsObservable.connect();\n    this.designMode = DesignService.designModeState;\n    this.isLoading = false;\n    this.isIonic = this.AppService.isIonic;\n  }\n\n  switchEditMode() {\n    this.editMode = true;\n  }\n\n  cancelEditFloorNameForm(e) {\n    e.preventDefault();\n    this.editMode = false;\n  }\n\n  submitEditFloorNameForm(e) {\n    e.preventDefault();\n    this.isLoading = true;\n    this.floorService.updateFloor(this.floor.floorID, {\n      floorName: this.editFloorNameForm.value.floorName\n    })\n      .delay(500)\n      .subscribe(\n        (res: any) => {\n          this.editMode = false;\n          this.isLoading = false;\n          this.floor.floorName = this.editFloorNameForm.value.floorName;\n        }\n      );\n  }\n\n  // changeOrder(direction) {\n  //   this.isLoading = true;\n  //   this.updateFloor\n  //     .next({\n  //       floorID: this.floor.floorID,\n  //       type: 'order',\n  //       direction: direction\n  //     });\n  // }\n  //\n  // showDeleteFloorConfirmation() {\n  //   this.showConfirmDeletion = true;\n  //   if (this.overlayObservable.subscription) {\n  //     this.overlayObservable.subscription\n  //       .next({\n  //         type: 'show',\n  //         message: `You are about to delete a floor. Are you sure you want to do that?\n  //           Be aware that you will also delete the reservations.`,\n  //         panelType: 'confirmation',\n  //         id: this.floor.floorID\n  //       });\n  //   }\n  // }\n\n  // deleteFloor() {\n  //   this.isLoading = true;\n  //   this.floorService.deleteFloor(this.floor.floorID)\n  //     .delay(200)\n  //     .subscribe(\n  //       (res: any) => {\n  //         if (res.status === 204) {\n  //           console.log(this.componentRef);\n  //           // this.componentRef.dispose();\n  //         }\n  //       }\n  //     );\n  // }\n\n  fetch(floorID) {\n    this.isLoading = true;\n    this.floorElementsService.fetchElementsByFloorID(floorID)\n      .delay(200)\n      .subscribe(\n        (res: any) => {\n          let arr = res.json().data;\n          this.floorElements = arr;\n          this.isLoading = false;\n          this.changeRef.markForCheck();\n        }\n      );\n  }\n\n  ngOnInit() {\n    let socket = io.connect(SOCKET_URL);\n\n    socket.on('elements', (res) => {\n      if (!this.DesignService.designModeState) {\n        let index = _.findIndex(this.floorElements, { elementID: res.elementID });\n        if (res.floorID === this.floor.floorID) {\n          if (index === -1) {\n            this.floorElements.push(res);\n          } else {\n            this.floorElements[index] = res;\n          }\n        }\n      }\n    });\n\n    socket.on('reservations', (res) => {\n      if (!this.DesignService.designModeState) {\n        this.ReservationService.fetchReservations()\n          .subscribe(() => {\n            this.reservations = this.ReservationService.reservations;\n            this.changeRef.markForCheck();\n          });\n      }\n    });\n\n    this.floorElementsObservable\n      .subscribe((res: any) => {\n        if (res.type === 'data') {\n          this.isLoading = false;\n          this.floorElements = res.data;\n        } else {\n          this.isLoading = true;\n        }\n        this.changeRef.detectChanges();\n      });\n\n    this.fetch(this.floor.floorID);\n    this.editFloorNameForm = this.fb.group({\n      floorName: [this.floor.floorName, Validators.required]\n    });\n  }\n\n}\n"],"sourceRoot":"/source/"}